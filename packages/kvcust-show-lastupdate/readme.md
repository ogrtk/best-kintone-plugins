# kViewer 最終更新日時表示スクリプト

## 概要

kViewerの一覧等において、対象アプリの**最終更新日時**を表示するためのJavaScriptカスタマイズスクリプトです。
kViewerの一覧表示は、画面上のページ単位でしかデータを保持しないため、正確な最終更新日時を表示するには、kViewerの外部公開APIを用いてアプリ全体の更新情報を取得します。

## 主な機能

* kViewer 外部公開APIを利用して、対象アプリ全体の最終更新日時を取得
* 取得した更新日時を、指定した画面要素内に表示
* 日付のみ、または日付＋時刻の形式で表示可能
* データが存在しない場合はプレースホルダを表示
* エラーハンドリングを強化し、運用中の不具合を検出しやすくしています

## 使用方法

### 1. kViewer 外部公開API の作成

* kViewer管理画面から、対象のアプリを外部公開APIとして公開してください。
* **更新日時を表す項目（例：`更新日時`）を必ず含めてください。**
* APIのソート順は、更新日時の降順（最新が先頭に来る）に設定してください。
* セキュリティの観点から、不要な項目は極力含めないでください。

### 2. kViewer 一覧画面のカスタマイズ設定

#### ヘッダーコンテンツの設定

* コンテンツタイプ: `HTML`
* コンテンツ例:

```html
<h1>一覧タイトル</h1>
<div id="lastupdate-space"></div>
```

#### JavaScriptカスタマイズ登録

* 本スクリプトを登録します。
* スクリプト内の `CONFIG` 部分を編集して必要な設定を行います。

### 3. スクリプト内の主な設定項目

| 設定キー                     | 内容                | 例                                                              |
| ------------------------ | ----------------- | -------------------------------------------------------------- |
| `API_URL`                | 外部公開APIのURL       | `"https://xxxx.viewer.kintoneapp.com/public/api/records/...."` |
| `LASTUPDATE_CHECK_FIELD` | 更新日時を保持するフィールド名   | `"更新日時"`                                                       |
| `ELEMENT_TO_PLACE`       | 表示先のHTML要素ID      | `"lastupdate-space"`                                           |
| `LABEL_TEXT`             | 表示ラベル             | `"最終更新日時"`                                                     |
| `NO_UPDATE_TEXT`         | データなし時の表示         | `"----年--月--日 --:--"`                                          |
| `DISPLAY_STYLE`          | 表示スタイル (CSS文字列)   | `"color: gray; font-size: 1.0rem; text-align: right;"`         |
| `DATE_ONLY`              | 日付のみ表示する場合は`true` | `false`                                                        |

## 動作例

```
最終更新日時 : 2025年06月13日 14:30
```

## エラーハンドリング

* 外部公開APIの通信失敗時はアラート表示
* レスポンスに指定項目が存在しない場合もアラート通知
* 処理中の例外はコンソールに出力

## 注意事項

* 本スクリプトは、外部公開APIの仕様に依存します。
* 実運用時はAPIアクセス制限やCORS制約にも注意してください。
* APIの公開対象は必要最低限の項目に限定し、個人情報等は含めないでください。

## 参考

* [kViewer 外部公開API仕様](https://kintone.cybozu.com/jp/)
* [kViewer カスタマイズ設定](https://kintone.cybozu.com/jp/)
